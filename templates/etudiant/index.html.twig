{% extends 'base.html.twig' %}

{% block body %}
    <div class="container mt-4">
        <h1 class="text-center mb-4">Inscription des étudiants</h1>

        <div class="card p-4 mb-4">
            {{ form_start(form, {'attr': {'class': 'needs-validation', 'novalidate': 'novalidate'}}) }}

            <div class="mb-3">
                {{ form_label(form.nom, null, {'class': 'form-label'}) }}
                {{ form_widget(form.nom, {'attr': {'class': 'form-control', 'placeholder': 'Entrez le nom'}}) }}
                {{ form_errors(form.nom) }}
            </div>

            <div class="mb-3">
                {{ form_label(form.prenom, null, {'class': 'form-label'}) }}
                {{ form_widget(form.prenom, {'attr': {'class': 'form-control', 'placeholder': 'Entrez le prénom'}}) }}
                {{ form_errors(form.prenom) }}
            </div>

            <div class="mb-3">
                {{ form_label(form.email, null, {'class': 'form-label'}) }}
                {{ form_widget(form.email, {'attr': {'class': 'form-control', 'placeholder': 'Entrez l\'email'}}) }}
                {{ form_errors(form.email) }}
            </div>

            <div class="mb-3">
                {{ form_label(form.dateNaissance, null, {'class': 'form-label'}) }}
                {{ form_widget(form.dateNaissance, {'attr': {'class': 'form-control', 'type': 'date'}}) }}
                {{ form_errors(form.dateNaissance) }}
            </div>

            <div class="mb-3">
                {{ form_label(form.adresse, null, {'class': 'form-label'}) }}
                {{ form_widget(form.adresse, {'attr': {'class': 'form-control', 'placeholder': 'Entrez l\'adresse'}}) }}
                {{ form_errors(form.adresse) }}
            </div>

            <button type="submit" class="btn btn-primary">Ajouter</button>
            {{ form_end(form) }}
        </div>

        <h2 class="text-center">Liste des étudiants</h2>

        <input type="text" id="search" class="form-control mb-3" placeholder="Rechercher un étudiant...">

        <table class="table table-striped table-bordered">
            <thead class="table-dark">
                <tr>
                    <th scope="col">ID</th>
                    <th scope="col">Nom</th>
                    <th scope="col">Prénom</th>
                    <th scope="col">Email</th>
                    <th scope="col">Opérations</th>
                </tr>
            </thead>
            <tbody id="etudiants-list">
                {% include 'etudiant/_list.html.twig' %}
            </tbody>
        </table>

        <!-- PAGINATION -->
        <nav>
            <ul class="pagination justify-content-center">
                {% if currentPage > 1 %}
                    <li class="page-item">
                        <a class="page-link" href="{{ path('etudiant', {'page': currentPage - 1}) }}">Précédent</a>
                    </li>
                {% endif %}

                {% for i in 1..totalPages %}
                    <li class="page-item {% if i == currentPage %}active{% endif %}">
                        <a class="page-link" href="{{ path('etudiant', {'page': i}) }}">{{ i }}</a>
                    </li>
                {% endfor %}

                {% if currentPage < totalPages %}
                    <li class="page-item">
                        <a class="page-link" href="{{ path('etudiant', {'page': currentPage + 1}) }}">Suivant</a>
                    </li>
                {% endif %}
            </ul>
        </nav>
    </div>

    <script>
        document.getElementById('search').addEventListener('keyup', function() {
            let query = this.value;
            
            fetch('{{ path("etudiant.search") }}?q=' + encodeURIComponent(query))
                .then(response => response.text())
                .then(html => {
                    document.getElementById('etudiants-list').innerHTML = html;
                });
        });
    </script>
{% endblock %}
